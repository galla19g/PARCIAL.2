<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestor de Contactos</title>
  <link rel="stylesheet" href="/estilos.css">
</head>
<body>
  <h1>ğŸ“‡ Lista de Contactos</h1>

  <form action="/buscar" method="get">
    <input type="text" name="q" placeholder="Buscar contacto...">
    <button type="submit">ğŸ” Buscar</button>
  </form>

  <table>
    <tr>
      <th>ID</th>
      <th>Imagen</th>
      <th>Primer Nombre</th>
      <th>Segundo Nombre</th>
      <th>Primer Apellido</th>
      <th>Segundo Apellido</th>
      <th>GÃ©nero</th>
      <th>Barrio</th>
      <th>Tipo TelÃ©fono</th>
      <th>Email</th>
      <th>TelÃ©fono</th>
      <th>Acciones</th>
    </tr>
    <% contactos.forEach(c => { %>
    <tr>
      <td><%= c.id_contacto %></td>
      <td>
        <% if (c.imagen) { %>
          <img src="/uploads/<%= c.imagen %>" alt="Foto de <%= c.primer_nombre %>" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
        <% } else { %>
          <span style="color: #999; font-style: italic;">Sin imagen</span>
        <% } %>
      </td>
      <td><%= c.primer_nombre %></td>
      <td><%= c.segundo_nombre || '-' %></td>
      <td><%= c.primer_apellido %></td>
      <td><%= c.segundo_apellido || '-' %></td>
      <td><%= c.detalle_genero || '-' %></td>
      <td><%= c.detalle_direccion || '-' %></td>
      <td><%= c.detalle_tipo_telefono || '-' %></td>
      <td><%= c.email %></td>
      <td><%= c.telefono %></td>
      <td>
        <a href="/editar/<%= c.id_contacto %>">âœï¸</a>
        <a href="/eliminar/<%= c.id_contacto %>" onclick="return confirm('Â¿Eliminar este contacto?')">ğŸ—‘ï¸</a>
      </td>
    </tr>
    <% }) %>
  </table>

  <h2>â• Agregar nuevo contacto</h2>
  <form action="/agregar" method="post">
    <input name="primer_nombre" placeholder="Primer nombre" required>
    <input name="segundo_nombre" placeholder="Segundo nombre">
    <input name="primer_apellido" placeholder="Primer apellido" required>
    <input name="segundo_apellido" placeholder="Segundo apellido">
    
    <select name="id_genero" required>
      <option value="">Seleccione gÃ©nero</option>
      <% generos.forEach(g => { %>
        <option value="<%= g.id_genero %>"><%= g.detalle_genero %></option>
      <% }) %>
    </select>
    
    <select name="id_direccion" required>
      <option value="">Seleccione barrio</option>
      <% direcciones.forEach(d => { %>
        <option value="<%= d.id_direccion %>"><%= d.detalle_direccion %></option>
      <% }) %>
    </select>
    
    <select name="id_tipo_telefono" required>
      <option value="">Seleccione tipo de telÃ©fono</option>
      <% tipos_telefono.forEach(t => { %>
        <option value="<%= t.id_tipo_telefono %>"><%= t.detalle_tipo_telefono %></option>
      <% }) %>
    </select>
    
    <input name="email" type="email" placeholder="Correo" required>
    <input name="telefono" placeholder="TelÃ©fono" required>
    <button type="submit">ğŸ’¾ Guardar</button>
  </form>

  <% if (barrios.length > 0) { %>
  <h2>ğŸ“Š Porcentaje de contactos por barrio</h2>
  <% barrios.forEach(b => { %>
    <p><strong><%= b.detalle_direccion %>:</strong> <%= b.porcentaje.toFixed(1) %>% (<%= b.cantidad %> contactos)</p>
    <progress value="<%= b.porcentaje %>" max="100"></progress>
  <% }) %>
  <% } %>
</body>
</html>